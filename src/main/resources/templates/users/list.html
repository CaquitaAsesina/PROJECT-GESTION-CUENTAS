<!DOCTYPE html>
<!-- Declaración del tipo de documento HTML5 -->
<html xmlns:th="http://www.thymeleaf.org">
<!-- xmlns:th: namespace de Thymeleaf para usar sus atributos especiales -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Usuarios</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS personalizado -->
    <style>
        /* Animación para las filas de la tabla */
        tbody tr {
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background-color: #f8f9fa;
            transform: scale(1.01);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Estilo del navbar */
        .custom-navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Badges animados */
        .badge {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>

    <!-- NAVBAR (Barra de navegación superior) -->
    <nav class="navbar navbar-expand-lg navbar-dark custom-navbar mb-4">
        <!-- navbar-expand-lg: se expande en pantallas grandes -->
        <!-- navbar-dark: texto blanco -->

        <div class="container-fluid">
            <!-- Brand / Logo -->
            <a class="navbar-brand" th:href="@{/}">
                <!-- th:href="@{/}": enlace a la página principal -->
                <i class="fas fa-layer-group"></i>
                <strong>Sistema de Cuentas</strong>
            </a>

            <!-- Botón hamburguesa para móviles -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Links de navegación -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- collapse: oculta en móviles -->
                <!-- navbar-collapse: estilos de Bootstrap -->

                <ul class="navbar-nav ms-auto">
                    <!-- ms-auto: margin-start auto (empuja a la derecha) -->

                    <!-- Link: Inicio -->
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/}">
                            <i class="fas fa-home"></i> Inicio
                        </a>
                    </li>

                    <!-- Link: Usuarios (activo) -->
                    <li class="nav-item">
                        <a class="nav-link active" th:href="@{/users}">
                            <!-- active: resalta el enlace actual -->
                            <i class="fas fa-users"></i> Usuarios
                        </a>
                    </li>

                    <!-- Link: Correos Gmail -->
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/gmails}">
                            <i class="fas fa-envelope"></i> Correos Gmail
                        </a>
                    </li>

                    <!-- Link: Cuentas -->
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/accounts}">
                            <i class="fas fa-id-card"></i> Cuentas
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- CONTAINER PRINCIPAL -->
    <div class="container">

        <!-- BREADCRUMB (Migas de pan) -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a th:href="@{/}">
                        <i class="fas fa-home"></i> Inicio
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    Usuarios
                </li>
            </ol>
        </nav>

        <!-- ENCABEZADO -->
        <div class="row mb-4">
            <div class="col-md-8">
                <h2 class="mb-0">
                    <i class="fas fa-users text-primary"></i>
                    Gestión de Usuarios
                </h2>
                <p class="text-muted">
                    <small>Administra los usuarios del sistema</small>
                </p>
            </div>

            <div class="col-md-4 text-end">
                <!-- Botón para crear nuevo usuario -->
                <a th:href="@{/users/new}" class="btn btn-primary btn-lg">
                    <i class="fas fa-plus-circle"></i> Nuevo Usuario
                </a>
            </div>
        </div>

        <!-- MENSAJES DE ÉXITO O ERROR -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle"></i>
            <strong>¡Éxito!</strong> <span th:text="${success}">Mensaje de éxito</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle"></i>
            <strong>Error:</strong> <span th:text="${error}">Mensaje de error</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- ESTADÍSTICAS RÁPIDAS -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="row text-center">
                            <!-- Total de usuarios -->
                            <div class="col-md-4">
                                <div class="p-3">
                                    <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                    <h4 class="mb-0" th:text="${users != null ? users.size() : 0}">0</h4>
                                    <small class="text-muted">Total Usuarios</small>
                                </div>
                            </div>

                            <!-- Total de cuentas (suma) -->
                            <div class="col-md-4">
                                <div class="p-3 border-start border-end">
                                    <i class="fas fa-id-card fa-2x text-success mb-2"></i>
                                    <!-- Suma todas las cuentas usando #aggregates.sum -->
                                    <h4 class="mb-0" th:text="${users != null ? #aggregates.sum(users.![cuentas]) : 0}">
                                        0</h4>
                                    <!-- users.![cuentas]: proyección que extrae todos los valores de cuentas -->
                                    <!-- #aggregates.sum: suma todos los valores -->
                                    <small class="text-muted">Total Cuentas</small>
                                </div>
                            </div>

                            <!-- Usuario con más cuentas -->
                            <div class="col-md-4">
                                <div class="p-3">
                                    <i class="fas fa-crown fa-2x text-warning mb-2"></i>
                                    <!-- Busca el máximo usando #aggregates.max -->
                                    <h4 class="mb-0"
                                        th:text="${users != null and !users.isEmpty() ? #aggregates.max(users.![cuentas]) : 0}">
                                        0</h4>
                                    <small class="text-muted">Máximo por Usuario</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TABLA DE USUARIOS -->
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-list"></i> Lista de Usuarios
                </h5>
            </div>

            <div class="card-body">

                <!-- Solo muestra la tabla si hay usuarios -->
                <div th:if="${users != null and !users.isEmpty()}">

                    <!-- Tabla responsive: permite scroll horizontal en móviles -->
                    <div class="table-responsive">
                        <table class="table table-hover table-striped">
                            <!-- table-hover: efecto hover -->
                            <!-- table-striped: filas alternadas -->

                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>Administrador</th>
                                    <th>Cuentas</th>
                                    <th>Fecha Registro</th>
                                    <th>Última Actualización</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr th:each="user : ${users}">

                                    <td>
                                        <strong th:text="${user.id}">1</strong>
                                    </td>

                                    <td>
                                        <i class="fas fa-user-circle text-primary"></i>
                                        <strong th:text="${user.administrador}">admin1</strong>
                                    </td>

                                    <td>
                                        <!-- Badge con color según cantidad de cuentas -->
                                        <span class="badge" th:classappend="${user.cuentas > 10 ? 'bg-success' : 
                                                              (user.cuentas > 5 ? 'bg-warning' : 
                                                              (user.cuentas > 0 ? 'bg-info' : 'bg-secondary'))}"
                                            th:text="${user.cuentas}">
                                            <!-- Verde si >10, amarillo si >5, celeste si >0, gris si 0 -->
                                            0
                                        </span>

                                        <!-- Enlaces rápidos a sus cuentas y correos -->
                                        <div class="btn-group btn-group-sm mt-1" role="group">
                                            <a th:href="@{/gmails/user/{id}(id=${user.id})}"
                                                class="btn btn-outline-success btn-sm" title="Ver sus correos Gmail">
                                                <i class="fas fa-envelope"></i>
                                            </a>
                                            <a th:href="@{/accounts/user/{id}(id=${user.id})}"
                                                class="btn btn-outline-info btn-sm" title="Ver sus cuentas">
                                                <i class="fas fa-id-card"></i>
                                            </a>
                                        </div>
                                    </td>

                                    <td>
                                        <small>
                                            <i class="fas fa-calendar-plus text-success"></i>
                                            <span
                                                th:text="${#temporals.format(user.fechaRegistro, 'dd/MM/yyyy HH:mm')}">
                                                01/01/2025 10:00
                                            </span>
                                        </small>
                                    </td>

                                    <td>
                                        <small>
                                            <i class="fas fa-calendar-check text-primary"></i>
                                            <span
                                                th:text="${#temporals.format(user.fechaActualizacion, 'dd/MM/yyyy HH:mm')}">
                                                01/01/2025 10:00
                                            </span>
                                        </small>
                                    </td>

                                    <td class="text-center">
                                        <!-- Grupo de botones -->
                                        <div class="btn-group" role="group">
                                            <!-- VER -->
                                            <a th:href="@{/users/{id}(id=${user.id})}" class="btn btn-sm btn-info"
                                                title="Ver detalles">
                                                <i class="fas fa-eye"></i>
                                            </a>

                                            <!-- EDITAR -->
                                            <a th:href="@{/users/edit/{id}(id=${user.id})}"
                                                class="btn btn-sm btn-warning" title="Editar">
                                                <i class="fas fa-edit"></i>
                                            </a>

                                            <!-- ELIMINAR -->
                                            <a th:href="@{/users/delete/{id}(id=${user.id})}"
                                                class="btn btn-sm btn-danger" title="Eliminar"
                                                onclick="return confirm('¿Está seguro de eliminar este usuario?');">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Información de resultados -->
                    <div class="mt-3 text-muted">
                        <small>
                            <i class="fas fa-info-circle"></i>
                            Mostrando <strong th:text="${users.size()}">0</strong> usuario(s)
                        </small>
                    </div>
                </div>

                <!-- MENSAJE SI NO HAY USUARIOS -->
                <div th:if="${users == null or users.isEmpty()}" class="alert alert-info text-center">
                    <i class="fas fa-inbox fa-3x mb-3 text-muted"></i>
                    <h5>No hay usuarios registrados</h5>
                    <p class="mb-3">Comienza creando el primer usuario del sistema</p>
                    <a th:href="@{/users/new}" class="btn btn-primary">
                        <i class="fas fa-plus-circle"></i> Crear Primer Usuario
                    </a>
                </div>
            </div>
        </div>

        <!-- ACCIONES RÁPIDAS -->
        <div class="row mt-4 mb-5">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="fas fa-bolt"></i> Acciones Rápidas
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-3">
                                <a th:href="@{/users/new}" class="btn btn-outline-primary w-100">
                                    <i class="fas fa-user-plus"></i> Nuevo Usuario
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a th:href="@{/gmails}" class="btn btn-outline-success w-100">
                                    <i class="fas fa-envelope"></i> Ver Correos
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a th:href="@{/accounts}" class="btn btn-outline-info w-100">
                                    <i class="fas fa-id-card"></i> Ver Cuentas
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a th:href="@{/}" class="btn btn-outline-secondary w-100">
                                    <i class="fas fa-home"></i> Inicio
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>

<!-- 
===== UBICACIÓN DEL ARCHIVO =====
src/main/resources/templates/users/list.html

===== FLUJO DE RENDERIZADO =====
1. Controller ejecuta: return "users/list";
2. Spring busca: templates/users/list.html
3. Thymeleaf procesa todos los th:* atributos
4. Reemplaza ${variables} con valores del Model
5. Genera HTML estático final
6. Envía HTML al navegador del usuario

===== EJEMPLO DE RENDERIZADO =====

THYMELEAF (en el servidor):
<td th:text="${user.administrador}">admin1</td>

HTML FINAL (enviado al navegador):
<td>admin1</td>

THYMELEAF:
<a th:href="@{/users/edit/{id}(id=${user.id})}">

HTML FINAL:
<a href="/users/edit/5">

===== VENTAJAS DE THYMELEAF =====
✅ Sintaxis natural HTML
✅ Los diseñadores pueden ver el HTML sin ejecutar el servidor
✅ Integración perfecta con Spring
✅ Seguridad contra XSS (escapa HTML automáticamente)
✅ Validación en tiempo de compilación

===== EXPRESIONES DE THYMELEAF =====
${variable}        - Variable del Model
@{/url}           - URL (agrega context path automáticamente)
#{message}        - Mensajes de i18n (internacionalización)
*{field}          - Campo del objeto actual (th:object)
th:if             - Condicional
th:each           - Bucle for
th:text           - Texto (escapa HTML)
th:utext          - Texto sin escapar (¡cuidado con XSS!)
th:href           - Atributo href
th:value          - Atributo value
th:attr           - Atributos dinámicos
-->